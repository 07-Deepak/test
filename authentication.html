<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sunteck Maxx World</title>
  <link rel="stylesheet" href="css/authentication.css">
  <link rel="shortcut icon" href="image/logo1.png" type="image/svg+xml">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    .input_wrap label i { margin-right: 8px; color: #fff; font-size: 16px; vertical-align: middle; }
    .hidden { display: none; }
    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; margin: auto; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>

<section class="header">
  <nav>
    <a href="index.html"><img src="image/logo.png" id="logo-img"></a>
    <div class="nav-links" id="navLinks">
      <span class="icon" onclick="hidemenu()">&#10005;</span>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="index.html#course_call">Notification</a></li>
        <li><a href="aboutus.html">About Us</a></li>
      </ul>
    </div>
    <span class="icon" onclick="showmenu()">&#9776;</span>
  </nav>

  <div class="wrapper">
    <div class="r_form_wrap">
      <div class="title"><p>Welcome</p></div>

      <!-- Login Form -->
      <div id="Login" class="tabcontent">
        <form id="loginForm">
          <div class="input_wrap">
            <label><i class="fa fa-envelope"></i> Email Address</label>
            <div class="input_item">
              <input type="email" id="login_email" required>
            </div>
          </div>
          <div class="input_wrap">
            <label><i class="fa fa-lock"></i> Password</label>
            <div class="input_item">
              <input type="password" id="login_password" required>
            </div>
          </div>
          <div id="loginLoading" class="hidden"><div class="spinner"></div></div>
          <input type="button" class="button" value="Login" onclick="loginUser()">
          <input type="button" class="button" value="Register" onclick="openForm('Register')">
          <p style="color:white; text-align:center; margin-top: 15px;">
            <a href="#" style="color:#FFD700;" onclick="openForm('Forgot')">Forgot Password?</a>
          </p>
        </form>
      </div>

      <!-- Register Form -->
      <div id="Register" class="tabcontent hidden">
        <form id="registerForm">
          <div class="input_wrap">
            <label><i class="fa fa-user"></i> Your Name</label>
            <div class="input_item">
              <input type="text" id="yourname" required>
            </div>
          </div>
          <div class="input_wrap">
            <label><i class="fa fa-envelope"></i> Email Address</label>
            <div class="input_item">
              <input type="email" id="emailaddress" required>
            </div>
          </div>
          <div class="input_wrap">
            <label><i class="fa fa-lock"></i> Password</label>
            <div class="input_item">
              <input type="password" id="register_password" required>
            </div>
          </div>
          <div class="input_wrap">
            <label><i class="fa fa-phone-square"></i> Phone</label>
            <div class="input_item">
              <input type="tel" id="phone" required>
            </div>
          </div>
          <div class="input_wrap">
            <label><i class="fa fa-list"></i> Building Wing</label>
            <div class="input_item">
              <select id="type">
                <option value="T1">T1</option>
                <option value="T2">T2</option>
              </select>
            </div>
          </div>
          <div class="input_wrap">
            <label><i class="fa fa-building"></i> Floor</label>
            <div class="input_item">
              <select id="floor">
                <option value="">Select Floor</option>
                <option value="1">Floor 1</option>
                <option value="2">Floor 2</option>
                <option value="3">Floor 3</option>
                <option value="4">Floor 4</option>
              </select>
            </div>
          </div>
          <div class="input_wrap">
            <label><i class="fa fa-door"></i> Room</label>
            <div class="input_item">
              <input type="text" id="room" required>
            </div>
          </div>
          <div id="registerLoading" class="hidden"><div class="spinner"></div></div>
          <input type="button" class="button" value="Register" onclick="registerUser()">
          <input type="button" class="button" value="Back to Login" onclick="openForm('Login')">
        </form>
      </div>

      <!-- Forgot Password Form -->
      <div id="Forgot" class="tabcontent hidden">
        <form id="forgotForm">
          <div class="input_wrap">
            <label><i class="fa fa-envelope"></i> Enter your registered Email</label>
            <div class="input_item">
              <input type="email" id="forgot_email" required>
            </div>
          </div>
          <div id="forgotLoading" class="hidden"><div class="spinner"></div></div>
          <input type="button" class="button" value="Send Reset Email" onclick="forgotPassword()">
          <input type="button" class="button" value="Back to Login" onclick="openForm('Login')">
        </form>
      </div>

    </div>
  </div>
</section>

<script>
  const firebaseConfig = {
  apiKey: "AIzaSyBuR-YwstGzMU9HSGrogNbBqTXN9hr6l80",
  authDomain: "sunteck1-36a23.firebaseapp.com",
  projectId: "sunteck1-36a23",
  storageBucket: "sunteck1-36a23.firebasestorage.app",
  messagingSenderId: "562096685576",
  appId: "1:562096685576:web:3bf98573623f55051107bd",
  measurementId: "G-ND03031XQ9"
};

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }
  const auth = firebase.auth();
  const database = firebase.database();

  window.onload = () => openForm('Login');

  function openForm(formName) {
    document.querySelectorAll('.tabcontent').forEach(el => el.classList.add('hidden'));
    document.getElementById(formName).classList.remove('hidden');
  }

  function isStrongPassword(password) {
    const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]).{8,}$/;
    return regex.test(password);
  }

  async function registerUser() {
    document.getElementById('registerLoading').classList.remove('hidden');
    const email = document.getElementById('emailaddress').value.trim();
    const password = document.getElementById('register_password').value.trim();
    const name = document.getElementById('yourname').value.trim();

    if (!isStrongPassword(password)) {
      alert("Password must be at least 8 characters long and include uppercase, lowercase, number, and special character.");
      document.getElementById('registerLoading').classList.add('hidden');
      return;
    }

    try {
      const userCredential = await auth.createUserWithEmailAndPassword(email, password);
      const uid = userCredential.user.uid;

      const data = {
        name: name,
        email: email,
        phone: document.getElementById('phone').value.trim(),
        type: document.getElementById('type').value,
        floor: document.getElementById('floor').value,
        room: document.getElementById('room').value.trim()
      };

      await database.ref('users/' + uid).set(data);
      await userCredential.user.sendEmailVerification();

      alert("Registration successful! Verification email sent. Please verify before login.");
      openForm('Login');
    } catch (error) {
      alert("Registration Error: " + error.message);
    } finally {
      document.getElementById('registerLoading').classList.add('hidden');
    }
  }

  async function loginUser() {
    document.getElementById('loginLoading').classList.remove('hidden');
    const email = document.getElementById('login_email').value.trim();
    const password = document.getElementById('login_password').value.trim();

    try {
      const userCredential = await auth.signInWithEmailAndPassword(email, password);
      if (!userCredential.user.emailVerified) {
        alert("Please verify your email before login.");
        await auth.signOut();
        return;
      }
      alert("Login successful! Redirecting to profile...");
      window.location.href = 'userprofile.html';
    } catch (error) {
      alert("Login Error: " + error.message);
    } finally {
      document.getElementById('loginLoading').classList.add('hidden');
    }
  }

  async function forgotPassword() {
    document.getElementById('forgotLoading').classList.remove('hidden');
    const email = document.getElementById('forgot_email').value.trim();

    try {
      await auth.sendPasswordResetEmail(email);
      alert("Password reset email sent successfully.");
      openForm('Login');
    } catch (error) {
      alert("Password Reset Error: " + error.message);
    } finally {
      document.getElementById('forgotLoading').classList.add('hidden');
    }
  }

  function showmenu() {
    document.getElementById("navLinks").style.right = "0";
  }
  function hidemenu() {
    document.getElementById("navLinks").style.right = "-200px";
  }
</script>

</body>
</html>
